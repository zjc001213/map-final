"use strict";(self["webpackChunkmap_lhz"]=self["webpackChunkmap_lhz"]||[]).push([[228],{25228:function(t,e,a){a.r(e),a.d(e,{default:function(){return S}});var i=function(){var t=this,e=t._self._c;return e("div",[e("tian-map",{attrs:{"rainfall-map":t.rainfall_map,"gatestation-map":t.gatestation_map}})],1)},n=[],s=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{width:"100%",height:"100%"}},[e("div",{staticStyle:{position:"absolute",width:"100%",height:"100%"},attrs:{id:"mapDiv"}}),e("div",{staticStyle:{position:"absolute","z-index":"9999",bottom:"10px",right:"20px"}},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.FcRegaltion}},[t._v("防洪调度模拟")]),e("a",{attrs:{href:"/download/flooddata.zip",download:"flooddata.zip"}},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleDownload}},[t._v(" 下载洪水数据 ")])],1)],1),e("infoWidnow",{directives:[{name:"show",rawName:"v-show",value:t.infoActive,expression:"infoActive"}],staticStyle:{"z-index":"888",position:"absolute",right:"10px",top:"calc(50% - 100px)"},attrs:{chartDate:t.current}}),e("el-dialog",{attrs:{center:!0,visible:t.visible,"before-close":t.handleClose,modal:!1,width:"500px"}},[[e("h1",{staticStyle:{"text-align":"center"}},[t._v("防洪调度模拟")])],e("el-divider"),e("div",{staticClass:"msg-dialog"},[e("div",{staticStyle:{margin:"0 auto"}},[e("el-dropdown",{staticStyle:{cursor:"pointer",width:"150px"},attrs:{trigger:"click"},on:{command:t.selectStatus}},[e("span",{staticClass:"el-dropdown-link",staticStyle:{width:"150px"}},[t._v(" "+t._s(t.statusInfo)),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"1"}},[t._v("2019年7月洪水")]),e("el-dropdown-item",{attrs:{command:"2"}},[t._v("2020年6月洪水")]),e("el-dropdown-item",{attrs:{command:"3"}},[t._v("2021年6月洪水")])],1)],1),e("el-button",{attrs:{type:"primary"}},[e("a",{staticStyle:{color:"white"},attrs:{href:t.flooddataUrl,download:"flood_test.txt"}},[t._v(" 下载洪水数据 ")])])],1),e("h3",[t._v("基本信息")]),e("span",{staticStyle:{display:"block"}},[t._v(" 当前3小时面降雨量："+t._s(t.simulateInfo.rainfall)+" 毫米 ")]),e("span",{staticStyle:{display:"block"}},[t._v(" 缙云河道3小时内流量："+t._s(t.simulateInfo.huzhentunnel)+" 立方米、 "+t._s(t.simulateInfo.donfangtunnel)+" 立方米、 "+t._s(t.simulateInfo.xiandutunnel)+" 立方米")])]),e("el-divider"),e("div",[e("div",{staticClass:"item"},[e("span",[t._v("预测缙云河道1小时后流量到达：")]),e("el-input",{staticClass:"block-text",staticStyle:{width:"100px",margin:"10px",color:"red"},attrs:{type:"number",placeholder:"xxx",min:"0"},model:{value:t.forecast,callback:function(e){t.forecast=e},expression:"forecast"}}),e("span",[t._v("立方米")])],1),e("div",{staticClass:"item",class:{parentCtn:t.hz>30}},[e("span",[t._v("壶镇河道：拦截流量")]),e("el-input",{staticClass:"block-text",staticStyle:{width:"100px",margin:"10px",color:"red"},attrs:{type:"number",placeholder:"xxx",min:"0"},model:{value:t.hz,callback:function(e){t.hz=e},expression:"hz"}}),e("span",{staticClass:"warn-info"},[t._v("上限30立方米")])],1),e("div",{staticClass:"item",class:{parentCtn:t.df>30}},[e("span",[t._v("东方河道：拦截流量")]),e("el-input",{staticClass:"block-text",staticStyle:{width:"100px",margin:"10px"},attrs:{type:"number",placeholder:"xxx",min:"0"},model:{value:t.df,callback:function(e){t.df=e},expression:"df"}}),e("span",{staticClass:"warn-info"},[t._v("上限30立方米")])],1),e("div",{staticClass:"item",class:{parentCtn:t.xd>30}},[e("span",[t._v("仙都河道：拦截流量")]),e("el-input",{staticClass:"block-text",staticStyle:{width:"100px",margin:"10px"},attrs:{type:"number",placeholder:"xxx",min:"0"},model:{value:t.xd,callback:function(e){t.xd=e},expression:"xd"}}),e("span",{staticClass:"warn-info"},[t._v("上限30立方米")])],1),e("div",{staticClass:"item",staticStyle:{"text-align":"center",margin:"15px 0"}},[e("span",{staticStyle:{"font-size":"24px",display:"block"}},[t._v("已经使用总调度量: "+t._s(t.ddl.toFixed(2))+" %")]),e("el-button",{attrs:{type:"primary"},on:{click:t.imitate}},[t._v(" 模拟调度 ")])],1)]),e("el-divider"),null!=t.imitateInfo?e("div",[e("span",[t._v("上述执行方案执行后，1小时缙云河道流量为："+t._s(t.imitateInfo.ljh.toFixed(2))+"立方米实际流量为：")]),e("h1",{style:{color:t.imitateInfo.ddl>250?"red":"green"}},[t._v(" "+t._s(t.imitateInfo.ddl)+"立方米 ")]),t.imitateInfo.ddl<250?e("h1",{staticStyle:{color:"green"}},[t._v("未超出警戒值")]):e("h1",{staticStyle:{color:"red"}},[t._v("已经超出警戒值")]),e("span",[t._v("缙云河道上线为：250立方米")])]):e("div",[e("span",[t._v("暂无数据")])])],2)],1)},o=[],l=a(36369),r=(a(1120),function(){var t=this,e=t._self._c;return e("div",{staticClass:"infoWindow"},[e("div",{staticClass:"info-container"},[e("h1",{staticClass:"info-title"},[t._v(t._s(t.chartDate&&t.chartDate.name))]),e("el-button",{staticClass:"info-download",attrs:{type:"primary"}},[e("a",{attrs:{href:t.url,type:"download"}},[t._v("下载相关数据")])]),e("div",{ref:"chart",staticStyle:{height:"300px",width:"100%"}})],1)])}),d=[],c=(a(57658),a(1708)),h=a.n(c),u=a(57535);a(53630);var p={props:{chartDate:{type:Object,default(){return{}}}},data(){return{chart:null,time:[],hourrain:[],title:"",url:""}},watch:{async chartDate(){if(this.url=`http://3f9406f9.r6.cpolar.top/hour/download?station=${this.chartDate.name}&hours=3`,this.chartDate&&this.chartDate.name){this.time=[],this.hourrain=[];const{data:t}=await(0,u.ex)(this.chartDate.name);t.data.forEach((t=>{let e=new Date(t.datetime);this.time.push(e.getHours()),this.hourrain.push(t.hourrain)}));let e=new Date(t.data[0].datetime),a=new Date(t.data[t.data.length-1].datetime);if(this.title=`${a.getMonth()+1+"月"+a.getDate()}日 - ${e.getMonth()+1+"月"+e.getDate()}日`,200==t.code){let t={title:{text:this.title},xAxis:{type:"category",data:this.time},yAxis:{type:"value"},series:[{data:this.hourrain,type:"line"}]};this.resetChart(t),this.chart.resize()}}}},mounted(){this.initChart()},methods:{initChart(){this.chart=h().init(this.$refs.chart)},resetChart(t){this.chart.setOption(t)},msgDownload(){(0,u.lT)("北山",3).then((t=>{console.log("data",t)}))}}},m=p,f=a(1001),v=(0,f.Z)(m,r,d,!1,null,"0a8fa744",null),w=v.exports;a(53630);l["default"].extend(w);a(53630);var x={components:{infoWidnow:w},props:{rainfallMap:{type:Array,default:function(){return[]}},gatestationMap:{type:Array,default:function(){return[]}}},data(){return{map:null,zoom:11,visible:!1,rainfallChart:[],gatestationChart:[],current:null,infoActive:!1,hz:0,df:0,xd:0,forecast:0,status:"",statusInfo:"2019年7月洪水",flooddataUrl:"./download/flood_test/test_201907.txt",imitateInfo:null,simulateInfo:{huzhentunnel:11,donfangtunnel:11,xiandutunnel:11,jinyuntunnel:11}}},watch:{rainfallMap:{handler(){this.map.clearOverLays(),this.initOverLay()},deep:!0},gatestationMap:{handler(){this.map.clearOverLays(),this.initOverLay()},deep:!0},status(){1==this.status?(this.statusInfo="2019年7月洪水",this.flooddataUrl="./download/flood_test/test_201907.txt"):2==this.status?(this.statusInfo="2020年6月洪水",this.flooddataUrl="./download/flood_test/test_202006.txt"):(this.statusInfo="2021年6月洪水",this.flooddataUrl="./download/flood_test/test_202106.txt")}},mounted(){let t=this;this.$nextTick((function(){t.initMap(),t.initOverLay(),this.getSimulateInfo()}))},computed:{ddl(){let t=1*this.hz+1*this.df+1*this.xd;return console.log(t),t/90*100}},methods:{initMap(){this.map=new T.Map("mapDiv"),this.map.centerAndZoom(new T.LngLat(120.421152,28.898532),this.zoom)},initOverLay(){let t=this;this.rainfallMap.forEach((e=>{let a=e;var i=new T.Icon({iconUrl:"./png/rain.png",iconSize:new T.Point(45,45),iconAnchor:new T.Point(12,41)});let n=new T.Marker(new T.LngLat(e.longitude,e.latitude),{icon:i});this.map.addOverLay(n);let s=new T.InfoWindow,o=`<div id='label'>${e.name}</div>`;s.setContent(o),n.addEventListener("mouseover",(()=>{n.openInfoWindow(s)})),n.addEventListener("click",(function(){t.current=a,t.infoActive=!0,t.map.centerAndZoom(new T.LngLat(n.or.lng,n.or.lat),13),t.addEvent()})),n.addEventListener("mouseout",(()=>{n.closeInfoWindow()}))})),this.gatestationMap.forEach((e=>{let a=e;var i=new T.Icon({iconUrl:"./png/ga1.png",iconSize:new T.Point(45,45),iconAnchor:new T.Point(10,25)});let n=new T.Marker(new T.LngLat(e.longitude,e.latitude),{icon:i});this.map.addOverLay(n);let s=new T.InfoWindow,o=`<div id='label'>${e.name}</div>`;s.setContent(o),n.addEventListener("mouseover",(t=>{n.openInfoWindow(s)})),n.addEventListener("click",(function(){t.current=a,t.infoActive=!0,t.map.centerAndZoom(new T.LngLat(n.or.lng,n.or.lat),13),t.addEvent()})),n.addEventListener("mouseout",(t=>{n.closeInfoWindow()}))}))},handleClose(){this.visible=!1},FcRegaltion(){this.visible=!0},handleDownload(){},addEvent(){document.addEventListener("mousedown",this._event)},removeEvent(){document.removeEventListener("mousedown",this._event)},_event(t){-1!=t.target.className.indexOf("tdt-container")&&(this.infoActive=!1)},selectStatus(t){console.log("val",t),this.status=t},getSimulateInfo(){(0,u.$H)().then((t=>{this.simulateInfo=t.data.data[0]}))},imitate(){let t=this.simulateInfo.huzhentunnel-this.hz,e=this.simulateInfo.donfangtunnel-this.df,a=this.simulateInfo.xiandutunnel-this.xd,i=13.65+.844*t+.387*e+.069*a+2e-4*t*t+4e-5*t*e-4e-4*t*a+3e-4*e*e-7e-4*e*a+5e-4*a*a;this.imitateInfo={ljh:i,ljd:this.forecast-i,ddl:((this.hz+this.df+this.xd)/90).toFixed(2),sj:this.statusInfo.jinyuntunnel-this.forecast-i}}}},g=x,_=(0,f.Z)(g,s,o,!1,null,null,null),y=_.exports,b=a(63822),C={components:{tianMap:y},data(){return{}},computed:{...(0,b.Se)(["rainfall_map","gatestation_map"])},created(){},methods:{initData(){getRainfallList().then((t=>{this.rainfall_map=t.data.data})),getGatestationList().then((t=>{this.gatestation_map=t.data.data}))}}},I=C,L=(0,f.Z)(I,i,n,!1,null,"5b190c17",null),S=L.exports}}]);
//# sourceMappingURL=228.a01ce0f7.js.map